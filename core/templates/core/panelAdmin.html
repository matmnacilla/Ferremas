<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administrador - Ferremas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    body {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 250px;
      background-color: #343a40;
      color: white;
      padding: 20px;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      display: block;
      padding: 10px 0;
    }
    .sidebar a:hover {
      background-color: #495057;
      border-radius: 5px;
    }
    .content {
      flex-grow: 1;
      padding: 40px;
      background-color: #f8f9fa;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    :root {
      --primary-color: #0d6efd;
      --sidebar-bg: #343a40;
      --sidebar-hover: #495057;
    }
    
    .sidebar {
      background-color: var(--sidebar-bg);
    }
    
    .sidebar a:hover {
      background-color: var(--sidebar-hover);
    }
    
    .btn-primary {
      background-color: var(--primary-color);
    }
    
    .table-hover tbody tr:hover {
      background-color: rgba(13, 110, 253, 0.05);
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h4>Admin - Ferremas</h4>
    <hr>
    <a href="#" onclick="showSection('dashboard')">üìä Dashboard</a>
    <a href="#" onclick="showSection('productos')">üì¶ Gesti√≥n de Productos</a>
    <a href="#" onclick="showSection('ofertas')">üè∑Ô∏è Gesti√≥n de Ofertas</a>
    <a href="#" onclick="showSection('empleados')">üë• Gesti√≥n de Empleados</a>
    <a href="#" onclick="showSection('ventas')">üìà Informe de Ventas</a>
    <a href="#" onclick="showSection('desempeno')">üìä Desempe√±o Tienda</a>
  </div>

  <div class="content">
    <!-- Dashboard Section -->
    <div id="dashboard" class="section active">
      <!-- Las tarjetas de resumen existentes se mantienen aqu√≠ -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Productos</h5>
              <h2 class="card-text">{{ total_productos }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">Stock Bajo</h5>
              <h2 class="card-text">{{ productos_stock_bajo }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">En Oferta</h5>
              <h2 class="card-text">{{ productos_oferta }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">Productos Activos</h5>
              <h2 class="card-text">{{ productos_activos }}</h2>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card bg-secondary text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Ventas</h5>
              <h2 class="card-text">{{ total_ventas }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-dark text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">Ventas este mes</h5>
              <h2 class="card-text">{{ ventas_mes }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-primary text-white mb-3">
            <div class="card-body">
              <h5 class="card-title">Empleados Activos</h5>
              <h2 class="card-text">{{ empleados_activos }}</h2>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Productos -->
    <div id="productos" class="section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Gesti√≥n de Productos</h2>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNuevoProducto">
          <i class="bi bi-plus-circle"></i> Nuevo Producto
        </button>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Imagen</th>
              <th>Nombre</th>
              <th>Categor√≠a</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for producto in productos %}
            <tr>
              <td>{{ producto.id }}</td>
              <td>
                {% if producto.imagen %}
                  <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" style="width: 50px; height: 50px; object-fit: cover;">
                {% else %}
                  <i class="bi bi-image text-muted"></i>
                {% endif %}
              </td>
              <td>{{ producto.nombre }}</td>
              <td>{{ producto.categoria }}</td>
              <td>${{ producto.precio }}</td>
              <td>{{ producto.stock }}</td>
              <td>
                {% if producto.activo %}
                  <span class="badge bg-success">Activo</span>
                {% else %}
                  <span class="badge bg-danger">Inactivo</span>
                {% endif %}
              </td>
              <td>
                <button class="btn btn-warning btn-sm" onclick="editarProducto('{{ producto.id }}')">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-danger btn-sm" onclick="eliminarProducto('{{ producto.id }}')">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Empleados -->
    <div id="empleados" class="section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Gesti√≥n de Empleados</h2>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNuevoEmpleado">
          <i class="bi bi-plus-circle"></i> Nuevo Empleado
        </button>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Departamento</th>
              <th>Cargo</th>
              <th>Tel√©fono</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for empleado in empleados %}
            <tr>
              <td>{{ empleado.id }}</td>
              <td>{{ empleado.usuario.get_full_name }}</td>
              <td>{{ empleado.usuario.email }}</td>
              <td>{{ empleado.departamento }}</td>
              <td>{{ empleado.cargo }}</td>
              <td>{{ empleado.telefono }}</td>
              <td>
                {% if empleado.activo %}
                  <span class="badge bg-success">Activo</span>
                {% else %}
                  <span class="badge bg-danger">Inactivo</span>
                {% endif %}
              </td>
              <td>
                <button class="btn btn-warning btn-sm" onclick="editarEmpleado('{{ empleado.id }}')">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-danger btn-sm" onclick="eliminarEmpleado('{{ empleado.id }}')">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Secci√≥n: Informe de Ventas -->
    <div id="ventas" class="section">
      <h2>Informe de Ventas Mensual</h2>
      <form class="row g-3 mb-4">
        <div class="col-md-4">
          <label for="mes" class="form-label">Mes</label>
          <select class="form-select" id="mes">
            <option>Enero</option><option>Febrero</option><option>Marzo</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="a√±o" class="form-label">A√±o</label>
          <input type="number" class="form-control" value="2025">
        </div>
        <div class="col-md-4 align-self-end">
          <button class="btn btn-primary w-100">Generar</button>
        </div>
      </form>
    </div>

    <!-- Secci√≥n: Desempe√±o -->
    <div id="desempeno" class="section">
      <h2>Informe de Desempe√±o de la Tienda</h2>
      <form class="row g-3 mb-4">
        <div class="col-md-4">
          <label>Desde</label>
          <input type="date" class="form-control">
        </div>
        <div class="col-md-4">
          <label>Hasta</label>
          <input type="date" class="form-control">
        </div>
        <div class="col-md-4 align-self-end">
          <button class="btn btn-primary w-100">Generar</button>
        </div>
      </form>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Ofertas -->
    <div id="ofertas" class="section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Gesti√≥n de Ofertas</h2>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Producto</th>
              <th>Categor√≠a</th>
              <th>Precio Actual</th>
              <th>Precio de Oferta</th>
              <th>Descuento</th>
              <th>Stock</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaOfertas">
            <!-- Los productos en oferta se cargar√°n din√°micamente aqu√≠ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal Nuevo Producto -->
    <div class="modal fade" id="modalNuevoProducto" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="{% url 'crear_producto' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title">Nuevo Producto</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" name="nombre" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Categor√≠a</label>
                <select name="categoria" class="form-select" required>
                  <option value="">Seleccione una categor√≠a</option>
                  {% for categoria in categorias %}
                    <option value="{{ categoria.nombre }}">{{ categoria.nombre }}</option>
                  {% endfor %}
                </select>
                <div class="form-text">
                  <a href="#" data-bs-toggle="modal" data-bs-target="#modalNuevaCategoria">
                    <i class="bi bi-plus-circle"></i> Agregar nueva categor√≠a
                  </a>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Precio</label>
                <input type="number" name="precio" class="form-control" min="1" required 
                       onblur="validarNumeroPositivo(this)">
                <div class="invalid-feedback">El precio debe ser mayor a 0</div>
              </div>
              <div class="mb-3">
                <label class="form-label">Stock</label>
                <input type="number" name="stock" class="form-control" min="1" required 
                       onblur="validarNumeroPositivo(this)">
                <div class="invalid-feedback">El stock debe ser mayor a 0</div>
              </div>
              <div class="mb-3">
                <label class="form-label">Descripci√≥n</label>
                <textarea name="descripcion" class="form-control" rows="3"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Imagen</label>
                <input type="file" name="imagen" class="form-control" accept="image/*">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-success">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Nuevo Empleado -->
    <div class="modal fade" id="modalNuevoEmpleado" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="{% url 'crear_empleado' %}" method="POST">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title">Nuevo Empleado</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nombre Completo</label>
                <input type="text" name="nombre" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Departamento</label>
                <select name="departamento" class="form-select" required>
                  <option value="ventas">Ventas</option>
                  <option value="bodega">Bodega</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Cargo</label>
                <input type="text" name="cargo" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Tel√©fono</label>
                <input type="tel" name="telefono" class="form-control" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-success">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Nueva Categor√≠a -->
    <div class="modal fade" id="modalNuevaCategoria" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="{% url 'crear_categoria' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title">Nueva Categor√≠a</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" name="nombre" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Descripci√≥n</label>
                <textarea name="descripcion" class="form-control" rows="3"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Imagen</label>
                <input type="file" name="imagen" class="form-control" accept="image/*">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-success">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Editar Producto -->
    <div class="modal fade" id="editarProductoModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar Producto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <form id="editarProductoForm" method="POST">
            {% csrf_token %}
            <div class="modal-body">
              <input type="hidden" name="id" id="editProductoId">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" name="nombre" id="edit_nombre" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Categor√≠a</label>
                <select name="categoria" id="edit_categoria" class="form-select" required>
                  {% for categoria in categorias %}
                    <option value="{{ categoria.nombre }}">{{ categoria.nombre }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Precio Actual ($)</label>
                <input type="number" name="precio" id="edit_precio" class="form-control" min="1" required onblur="validarNumeroPositivo(this)">
              </div>
              <div class="mb-3">
                <label class="form-label">Precio de Oferta ($) - Opcional</label>
                <input type="number" name="precio_oferta" id="edit_precio_oferta" class="form-control" min="1" onblur="validarPrecioOferta(this)">
                <div class="form-text">Dejar vac√≠o para quitar la oferta. Debe ser menor al precio actual.</div>
              </div>
              <div class="mb-3">
                <label class="form-label">Stock</label>
                <input type="number" name="stock" id="edit_stock" class="form-control" min="0" required onblur="validarNumeroPositivo(this)">
              </div>
              <div class="mb-3">
                <label class="form-label">Descripci√≥n</label>
                <textarea name="descripcion" id="edit_descripcion" class="form-control" rows="3"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Imagen</label>
                <div id="edit_imagen_actual" class="mb-2"></div>
                <input type="file" name="imagen" class="form-control" accept="image/*">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Editar Empleado -->
    <div class="modal fade" id="modalEditarEmpleado" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="formEditarEmpleado" method="POST">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title">Editar Empleado</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" name="empleado_id" id="edit_empleado_id">
              <div class="mb-3">
                <label class="form-label">Nombre Completo</label>
                <input type="text" name="nombre" id="edit_nombre" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="email" id="edit_email" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Departamento</label>
                <select name="departamento" id="edit_departamento" class="form-select" required>
                  <option value="ventas">Ventas</option>
                  <option value="bodega">Bodega</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Cargo</label>
                <input type="text" name="cargo" id="edit_cargo" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Tel√©fono</label>
                <input type="tel" name="telefono" id="edit_telefono" class="form-control" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts para la gesti√≥n -->
    <script>
      // Funciones de gesti√≥n
      function editarProducto(id) {
        // Obtener los datos del producto mediante AJAX
        fetch(`/panel/productos/obtener/${id}/`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const producto = data.producto;
              // Llenar el formulario con los datos del producto
              document.getElementById('editProductoId').value = producto.id;
              document.getElementById('edit_nombre').value = producto.nombre;
              document.getElementById('edit_categoria').value = producto.categoria;
              document.getElementById('edit_precio').value = producto.precio;
              document.getElementById('edit_precio_oferta').value = producto.precio_oferta || '';
              document.getElementById('edit_stock').value = producto.stock;
              document.getElementById('edit_descripcion').value = producto.descripcion;
              
              // Mostrar la imagen actual si existe
              const imagenContainer = document.getElementById('edit_imagen_actual');
              if (producto.imagen) {
                imagenContainer.innerHTML = `
                  <img src="${producto.imagen}" alt="${producto.nombre}" 
                       style="max-width: 200px; max-height: 200px;" class="img-thumbnail">
                `;
              } else {
                imagenContainer.innerHTML = '<p class="text-muted">No hay imagen</p>';
              }

              // Actualizar la acci√≥n del formulario
              document.getElementById('editarProductoForm').action = `/panel/productos/editar/${id}/`;
              
              // Mostrar el modal
              const modal = new bootstrap.Modal(document.getElementById('editarProductoModal'));
              modal.show();
            } else {
              alert('Error al cargar los datos del producto');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error al cargar los datos del producto');
          });
      }

      function validarPrecioOferta(input) {
        const precioActual = document.getElementById('edit_precio').value;
        const precioOferta = input.value;
        
        if (precioOferta && precioActual) {
          if (parseFloat(precioOferta) <= 0) {
            input.classList.add('is-invalid');
            input.nextElementSibling.textContent = 'El precio de oferta debe ser mayor a 0';
            return false;
          }
          if (parseFloat(precioOferta) >= parseFloat(precioActual)) {
            input.classList.add('is-invalid');
            input.nextElementSibling.textContent = 'El precio de oferta debe ser menor al precio actual';
            return false;
          }
        }
        
        input.classList.remove('is-invalid');
        return true;
      }

      // Manejar el env√≠o del formulario de edici√≥n
      document.getElementById('editarProductoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validar campos antes de enviar
        const precio = document.getElementById('edit_precio');
        const stock = document.getElementById('edit_stock');
        const precioOferta = document.getElementById('edit_precio_oferta');
        
        if (!validarNumeroPositivo(precio) || !validarNumeroPositivo(stock)) {
          alert('Por favor, ingrese valores v√°lidos mayores a 0 para precio y stock');
          return;
        }
        
        if (precioOferta.value && !validarPrecioOferta(precioOferta)) {
          alert('Por favor, corrija el precio de oferta');
          return;
        }
        
        const formData = new FormData(this);
        
        fetch(this.action, {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Cerrar el modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editarProductoModal'));
            modal.hide();
            // Recargar la p√°gina para mostrar los cambios
            window.location.reload();
          } else if (data.error) {
            alert(data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error al guardar los cambios');
        });
      });

      function eliminarProducto(id) {
        if (confirm('¬øEst√°s seguro de que deseas eliminar este producto?')) {
          window.location.href = `/panel/productos/eliminar/${id}/`;
        }
      }

      function editarEmpleado(id) {
        // Obtener los datos del empleado mediante AJAX
        fetch(`/panel/empleados/obtener/${id}/`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const empleado = data.empleado;
              // Llenar el formulario con los datos del empleado
              document.getElementById('edit_empleado_id').value = empleado.id;
              document.getElementById('edit_nombre').value = empleado.nombre;
              document.getElementById('edit_email').value = empleado.email;
              document.getElementById('edit_departamento').value = empleado.departamento;
              document.getElementById('edit_cargo').value = empleado.cargo;
              document.getElementById('edit_telefono').value = empleado.telefono;

              // Actualizar la acci√≥n del formulario
              document.getElementById('formEditarEmpleado').action = `/panel/empleados/editar/${id}/`;
              
              // Mostrar el modal
              const modal = new bootstrap.Modal(document.getElementById('modalEditarEmpleado'));
              modal.show();
            } else {
              alert('Error al cargar los datos del empleado');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error al cargar los datos del empleado');
          });
      }

      // Manejar el env√≠o del formulario de edici√≥n de empleado
      document.getElementById('formEditarEmpleado').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        
        fetch(this.action, {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Cerrar el modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalEditarEmpleado'));
            modal.hide();
            // Recargar la p√°gina para mostrar los cambios
            window.location.reload();
          } else if (data.error) {
            alert(data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error al guardar los cambios');
        });
      });

      function eliminarEmpleado(id) {
        if (confirm('¬øEst√°s seguro de que deseas eliminar este empleado?')) {
          window.location.href = `/panel/empleados/eliminar/${id}/`;
        }
      }

      // Manejo de mensajes de Django
      document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('.alert');
        messages.forEach(function(message) {
          setTimeout(function() {
            message.style.display = 'none';
          }, 5000);
        });
      });
    </script>

    <!-- Mensajes de Django -->
    {% if messages %}
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1050">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <script>
      function showSection(id) {
        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        document.getElementById(id).classList.add('active');
      }
    </script>

    <!-- Bootstrap Bundle con Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Funci√≥n para actualizar el select de categor√≠as despu√©s de crear una nueva
      function actualizarCategorias(nuevaCategoria) {
        const select = document.querySelector('select[name="categoria"]');
        const option = document.createElement('option');
        option.value = nuevaCategoria.nombre;
        option.textContent = nuevaCategoria.nombre;
        select.appendChild(option);
        select.value = nuevaCategoria.nombre;
      }

      // Manejar el env√≠o del formulario de categor√≠a
      document.querySelector('#modalNuevaCategoria form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const modal = document.getElementById('modalNuevaCategoria');
        
        fetch('{% url "crear_categoria" %}', {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Error en la respuesta del servidor');
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            actualizarCategorias(data.categoria);
            const bsModal = bootstrap.Modal.getInstance(modal);
            if (bsModal) {
              bsModal.hide();
            }
            // Mostrar mensaje de √©xito
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show';
            alert.innerHTML = `
              ${data.message}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.content').prepend(alert);
            // Limpiar el formulario
            this.reset();
          } else {
            throw new Error(data.message || 'Error al crear la categor√≠a');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          // Mostrar mensaje de error
          const alert = document.createElement('div');
          alert.className = 'alert alert-danger alert-dismissible fade show';
          alert.innerHTML = `
            ${error.message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          `;
          document.querySelector('.content').prepend(alert);
        });
      });
    </script>

    <script>
      // Funci√≥n para validar n√∫meros positivos
      function validarNumeroPositivo(input) {
        // Solo validar si el campo tiene un valor
        if (input.value.trim() === '') {
          input.classList.remove('is-invalid');
          return true;
        }

        const value = parseInt(input.value);
        if (isNaN(value) || value <= 0) {
          input.classList.add('is-invalid');
          return false;
        }
        input.classList.remove('is-invalid');
        return true;
      }

      // Validar formularios antes de enviar
      document.querySelector('#modalNuevoProducto form').addEventListener('submit', function(e) {
        const precio = this.querySelector('input[name="precio"]');
        const stock = this.querySelector('input[name="stock"]');
        
        if (!validarNumeroPositivo(precio) || !validarNumeroPositivo(stock)) {
          e.preventDefault();
          alert('Por favor, ingrese valores v√°lidos mayores a 0');
        }
      });

      document.querySelector('#editarProductoForm').addEventListener('submit', function(e) {
        const precio = this.querySelector('input[name="precio"]');
        const stock = this.querySelector('input[name="stock"]');
        
        if (!validarNumeroPositivo(precio) || !validarNumeroPositivo(stock)) {
          e.preventDefault();
          alert('Por favor, ingrese valores v√°lidos mayores a 0');
        }
      });
    </script>

    <script>
      function cargarOfertas() {
        fetch('/panel/productos/ofertas/')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const tbody = document.getElementById('tablaOfertas');
              tbody.innerHTML = '';
              
              data.productos.forEach(producto => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                  <td>
                    <div class="d-flex align-items-center">
                      ${producto.imagen ? 
                        `<img src="${producto.imagen}" alt="${producto.nombre}" class="me-2" style="width: 40px; height: 40px; object-fit: cover;">` :
                        `<i class="bi bi-box me-2" style="font-size: 1.5rem;"></i>`
                      }
                      ${producto.nombre}
                    </div>
                  </td>
                  <td>${producto.categoria}</td>
                  <td><del>$${producto.precio.toLocaleString()}</del></td>
                  <td class="text-danger fw-bold">$${producto.precio_oferta.toLocaleString()}</td>
                  <td><span class="badge bg-danger">-${producto.descuento}%</span></td>
                  <td>${producto.stock}</td>
                  <td>
                    <button class="btn btn-sm btn-primary" onclick="editarProducto(${producto.id})">
                      <i class="bi bi-pencil"></i> Editar
                    </button>
                  </td>
                `;
                tbody.appendChild(tr);
              });
            }
          })
          .catch(error => console.error('Error:', error));
      }

      // Cargar ofertas cuando se muestra la secci√≥n
      document.querySelector('a[onclick="showSection(\'ofertas\')"]').addEventListener('click', cargarOfertas);
    </script>

</body>
</html>
